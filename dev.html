<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Showroom IT/OT - Reservas</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
  background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);
  color:#e0e0e0;
  min-height:100vh;
  padding:20px;
}
.container{
  max-width:1800px;
  margin:0 auto;
  display:grid;
  grid-template-columns:450px 1fr;
  gap:30px;
  align-items:start;
}
.header{
  grid-column:1 / -1;
  text-align:center;
  margin-bottom:20px;
  padding:20px;
  background:linear-gradient(135deg,#0f3460 0%,#16213e 100%);
  border-radius:10px;
  box-shadow:0 4px 15px rgba(0,0,0,.3);
}
.header h1{
  color:#ff6b35;
  font-size:2.5em;
  text-shadow:2px 2px 4px rgba(0,0,0,.5);
}
.form-panel{
  background:linear-gradient(135deg,#1e2a3a 0%,#243447 100%);
  padding:30px;
  border-radius:12px;
  box-shadow:0 8px 25px rgba(0,0,0,.4);
  border:1px solid #2d3e50;
}
.form-panel h2{
  margin-bottom:15px;
}
.form-group{margin-bottom:20px}
.form-group label{
  display:block;
  margin-bottom:8px;
  color:#a8dadc;
  font-weight:600;
  font-size:.95em;
}
.form-group input,
.form-group textarea{
  width:100%;
  padding:12px;
  border:2px solid #2d3e50;
  border-radius:6px;
  background:#1a2332;
  color:#e0e0e0;
  font-size:1em;
  transition:all .3s;
}
.form-group input:focus,
.form-group textarea:focus{
  outline:none;
  border-color:#ff6b35;
  box-shadow:0 0 10px rgba(255,107,53,.3);
}
.form-group textarea{
  resize:vertical;
  min-height:80px;
}

.guest-form{
  display:flex;
  gap:10px;
  margin-bottom:10px;
  flex-wrap:wrap;
}
.guest-form input{
  flex:1;
  min-width:140px;
}
.btn-guest-add{
  padding:10px 16px;
  border:none;
  border-radius:6px;
  background:#457b9d;
  color:#fff;
  font-size:.85em;
  font-weight:600;
  cursor:pointer;
  transition:all .3s;
  white-space:nowrap;
}
.btn-guest-add:hover{
  transform:translateY(-1px);
  box-shadow:0 3px 8px rgba(0,0,0,.3);
}
#guestList{
  margin-top:5px;
}
.guest-list-item{
  font-size:.85em;
  color:#cfd8dc;
  margin-bottom:4px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
}
.guest-text{
  flex:1;
}
.guest-actions{
  display:flex;
  gap:6px;
}
.guest-btn{
  padding:3px 8px;
  border:none;
  border-radius:4px;
  font-size:.75em;
  cursor:pointer;
}
.guest-btn.edit{
  background:#457b9d;
  color:#fff;
}
.guest-btn.delete{
  background:#e63946;
  color:#fff;
}

.solutions-section{margin-top:25px}
.solution-item{
  margin-bottom:20px;
  padding:15px;
  background:#1a2332;
  border-radius:8px;
  border-left:4px solid #ff6b35;
}
.solution-checkbox{
  display:flex;
  align-items:center;
  margin-bottom:10px;
}
.solution-checkbox input[type="checkbox"]{
  width:20px;
  height:20px;
  margin-right:10px;
  cursor:pointer;
}
.solution-checkbox label{
  cursor:pointer;
  font-weight:600;
  color:#ff6b35;
  font-size:1.05em;
}
.brands-group{
  margin-left:30px;
  margin-top:10px;
  display:none;
}
.brands-group.active{display:block}
.brand-option{
  display:flex;
  align-items:center;
  margin-bottom:6px;
}
.brand-option input[type="radio"]{
  width:18px;
  height:18px;
  margin-right:8px;
  cursor:pointer;
}
.brand-option label{
  cursor:pointer;
  color:#a8dadc;
  font-size:.9em;
}

.buttons-group{
  margin-top:30px;
  display:flex;
  gap:15px;
}
.btn{
  flex:1;
  padding:15px 25px;
  border:none;
  border-radius:8px;
  font-size:1em;
  font-weight:600;
  cursor:pointer;
  transition:all .3s;
  box-shadow:0 4px 10px rgba(0,0,0,.3);
}
.btn-primary{
  background:linear-gradient(135deg,#ff6b35 0%,#e85d2a 100%);
  color:#fff;
}
.btn-primary:hover:not(:disabled){
  transform:translateY(-2px);
  box-shadow:0 6px 15px rgba(255,107,53,.4);
}
.btn-secondary{
  background:linear-gradient(135deg,#457b9d 0%,#1d3557 100%);
  color:#fff;
}
.btn-secondary:hover:not(:disabled){
  transform:translateY(-2px);
  box-shadow:0 6px 15px rgba(69,123,157,.4);
}
.btn:disabled{
  opacity:.5;
  cursor:not-allowed;
}

.fallback-section{
  margin-top:20px;
  padding:20px;
  background:#1a2332;
  border-radius:8px;
  border:2px solid:#ff6b35;
}
.fallback-section h3{
  color:#ff6b35;
  margin-bottom:15px;
}
.fallback-section textarea{
  width:100%;
  min-height:200px;
  padding:12px;
  background:#0f1923;
  color:#e0e0e0;
  border:1px solid #2d3e50;
  border-radius:6px;
  font-family:monospace;
  font-size:.9em;
}

.diagram-panel{
  background:linear-gradient(135deg,#1e2a3a 0%,#243447 100%);
  padding:25px;
  border-radius:12px;
  box-shadow:0 8px 25px rgba(0,0,0,.4);
  border:1px solid #2d3e50;
  min-height:520px;
  position:relative;
}
.diagram-panel h2{
  color:#ff6b35;
  margin-bottom:10px;
  font-size:1.4em;
}
.diagram-panel p{
  font-size:.85em;
  color:#a8dadc;
  margin-bottom:10px;
}
#diagram-container{
  width:100%;
  height:420px;
  position:relative;
  background:#0f1923;
  border-radius:8px;
  overflow:hidden;
  border:1px dashed #2d3e50;
}

/* Calendario y horarios */
.calendar-wrapper {
  background: #020617;
  border-radius: 10px;
  padding: 12px;
  border: 1px solid #1f2937;
}
.calendar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}
.calendar-month-label {
  font-weight: 600;
  color: #e5e7eb;
}
.calendar-nav button {
  background: #111827;
  border: 1px solid #374151;
  color: #e5e7eb;
  border-radius: 4px;
  padding: 4px 8px;
  cursor: pointer;
  font-size: 0.8rem;
}
.calendar-nav button:hover {
  border-color: #f97316;
}
.calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
  font-size: 0.8rem;
}
.calendar-day-header {
  text-align: center;
  color: #9ca3af;
  font-weight: 600;
}
.calendar-day {
  text-align: center;
  padding: 4px 0;
  border-radius: 4px;
  cursor: pointer;
  background: #0f172a;
  color: #e5e7eb;
  min-height: 26px;
}
.calendar-day.empty {
  background: transparent;
  cursor: default;
}
.calendar-day.today {
  outline: 1px dashed #f97316;
}
.calendar-day.selected {
  border: 1px solid #f97316;
  box-shadow: 0 0 10px rgba(249,115,22,0.6);
}
.calendar-day.fully-booked {
  background: #7f1d1d;
  color: #fecaca;
  cursor: not-allowed;
}
.calendar-day.disabled{
  opacity:.3;
  cursor:not-allowed;
  background:transparent;
}

.time-selector {
  margin-top: 10px;
}
.time-selector-title {
  font-size: 0.85rem;
  margin-bottom: 4px;
  color: #9ca3af;
}
.time-slot-btn {
  display: block;
  width: 100%;
  text-align: left;
  margin-bottom: 6px;
  padding: 6px 8px;
  background: #020617;
  border-radius: 4px;
  border: 1px solid #111827;
  color: #e5e7eb;
  cursor: pointer;
  font-size: 0.85rem;
}
.time-slot-btn:hover {
  border-color: #f97316;
}
.time-slot-btn.selected {
  border-color: #f97316;
  box-shadow: 0 0 8px rgba(249,115,22,0.8);
}
.time-slot-btn.busy {
  background: #3b1f23;
  border-color: #b91c1c;
  color: #fecaca;
  cursor: not-allowed;
}

@media(max-width:1400px){
  .container{
    grid-template-columns:1fr;
  }
}
</style>
</head>
<body>

<!-- PASO 1 -->
<div id="step1-wrapper" class="container">
  <div class="header">
    <h1>üè≠ Showroom IT/OT</h1>
  </div>

  <div class="form-panel">
    <h2>Paso 1 ‚Äì Datos del Cliente y Reserva</h2>

    <div class="form-group">
      <label for="clientName">Nombre del cliente (persona de contacto) *</label>
      <input type="text" id="clientName" required>
    </div>

    <!-- Calendario + horario -->
    <div class="form-group">
      <label>Fecha y horario solicitados *</label>
      <div class="calendar-wrapper">
        <div class="calendar-header">
          <div class="calendar-month-label" id="calendar-month-label"></div>
          <div class="calendar-nav">
            <button type="button" onclick="changeMonth(-1)">&lt;</button>
            <button type="button" onclick="changeMonth(1)">&gt;</button>
          </div>
        </div>
        <div class="calendar-grid" id="calendar-grid"></div>
      </div>

      <div class="time-selector">
        <div class="time-selector-title">Horarios disponibles (10:00 - 17:00)</div>
        <div id="time-slot-list"></div>
      </div>

      <input type="hidden" id="requestedDate">
    </div>

    <div class="form-group">
      <label for="comments">Comentarios (opcional)</label>
      <textarea id="comments"></textarea>
    </div>

    <div class="form-group">
      <label for="companyName">Nombre de la empresa</label>
      <input type="text" id="companyName" placeholder="Ej: ACME Manufacturing">
    </div>

    <div class="form-group">
      <label for="guestCount">Cantidad de invitados por parte del cliente</label>
      <input type="number" id="guestCount" min="0" placeholder="Ej: 5">
    </div>

    <div class="form-group">
      <label>Invitados del cliente (nombre y puesto)</label>
      <div class="guest-form">
        <input type="text" id="guestNameInput" placeholder="Nombre del invitado">
        <input type="text" id="guestRoleInput" placeholder="Puesto">
        <button type="button" class="btn-guest-add" onclick="addGuest()">Agregar invitado</button>
      </div>
      <div id="guestList"></div>
    </div>

    <div class="form-group">
      <label for="sector">Sector de la empresa</label>
      <input type="text" id="sector" placeholder="Ej: Automotriz, Manufactura, Energ√≠a...">
    </div>

    <div class="form-group" style="margin-top:10px;">
      <label>
        <input type="checkbox" id="labTeamPresent" style="width:16px;height:16px;margin-right:6px;">
        Requieren que la presentaci√≥n la d√© el equipo de laboratorio
      </label>
    </div>

    <div class="buttons-group">
      <button type="button" class="btn btn-primary" onclick="goToStep2()">Siguiente</button>
    </div>
  </div>

  <div class="diagram-panel">
    <h2>Portal de Reservaci√≥n ‚Äì Showroom OT</h2>
    <p>
      Este portal est√° dise√±ado para que los ejecutivos reserven sesiones en el Showroom IT/OT,
      capturando los datos del cliente, la fecha y las soluciones que se demostrar√°n.
    </p>
    <p>
      <strong>Reglamento (versi√≥n inicial ‚Äì se puede mejorar):</strong>
    </p>
    <ul style="margin-top:10px;padding-left:20px;font-size:.85em;color:#cbd5f5;">
      <li>Las reservas se realizan en horarios de demostraci√≥n entre <strong>10:00 y 17:00</strong>.</li>
      <li>Cada sesi√≥n dura <strong>1 hora</strong> y se bloquea una hora antes y despu√©s del horario seleccionado.</li>
      <li>El calendario permite navegar entre meses y seleccionar d√≠as futuros.</li>
      <li>Las fechas con todos los horarios ocupados se marcan en rojo.</li>
      <li>Las soluciones seleccionadas deben incluir marca obligatoriamente.</li>
    </ul>
    <div style="margin-top:15px;font-size:.8em;color:#9ca3af;">
      El diagrama detallado de la maqueta se visualiza en el Paso 2.
    </div>
  </div>
</div>

<!-- PASO 2 -->
<div id="step2-wrapper" class="container" style="display:none">
  <div class="header">
    <h1>üè≠ Showroom IT/OT</h1>
  </div>

  <div class="form-panel">
    <h2>Paso 2 ‚Äì Selecci√≥n de Tecnolog√≠as y Env√≠o</h2>
    <form id="reservationForm">

      <div class="solutions-section">
        <h3 style="color:#a8dadc;margin-bottom:15px;">Soluciones a Demostrar *</h3>

        <div class="solution-item">
          <div class="solution-checkbox">
            <input type="checkbox" id="sol-fw-ot" onchange="toggleBrands('fw-ot');renderArchitectureDiagram();">
            <label for="sol-fw-ot">FW OT (Firewall OT)</label>
          </div>
          <div class="brands-group" id="brands-fw-ot">
            <div class="brand-option">
              <input type="radio" id="fw-fortinet" name="fw-ot-brand" value="Fortinet">
              <label for="fw-fortinet">Fortinet</label>
            </div>
            <div class="brand-option">
              <input type="radio" id="fw-checkpoint" name="fw-ot-brand" value="Check Point">
              <label for="fw-checkpoint">Check Point</label>
            </div>
            <div class="brand-option">
              <input type="radio" id="fw-txone" name="fw-ot-brand" value="TXOne Networks">
              <label for="fw-txone">TXOne Networks</label>
            </div>
            <div class="brand-option">
              <input type="radio" id="fw-paloalto" name="fw-ot-brand" value="Palo Alto Networks">
              <label for="fw-paloalto">Palo Alto Networks</label>
            </div>
          </div>
        </div>

        <div class="solution-item">
          <div class="solution-checkbox">
            <input type="checkbox" id="sol-visibility" onchange="toggleBrands('visibility');renderArchitectureDiagram();">
            <label for="sol-visibility">Visibilidad de Red OT</label>
          </div>
          <div class="brands-group" id="brands-visibility">
            <div class="brand-option">
              <input type="radio" id="vis-nozomi" name="visibility-brand" value="Nozomi">
              <label for="vis-nozomi">Nozomi Networks</label>
            </div>
            <div class="brand-option">
              <input type="radio" id="vis-tenable" name="visibility-brand" value="Tenable OT">
              <label for="vis-tenable">Tenable OT</label>
            </div>
            <div class="brand-option">
              <input type="radio" id="vis-claroty" name="visibility-brand" value="Claroty">
              <label for="vis-claroty">Claroty</label>
            </div>
          </div>
        </div>

        <div class="solution-item">
          <div class="solution-checkbox">
            <input type="checkbox" id="sol-vuln" onchange="toggleBrands('vuln');renderArchitectureDiagram();">
            <label for="sol-vuln">Gesti√≥n de vulnerabilidades OT</label>
          </div>
          <div class="brands-group" id="brands-vuln">
            <div class="brand-option">
              <input type="radio" id="vuln-nozomi" name="vuln-brand" value="Nozomi">
              <label for="vuln-nozomi">Nozomi Networks</label>
            </div>
            <div class="brand-option">
              <input type="radio" id="vuln-tenable" name="vuln-brand" value="Tenable OT">
              <label for="vuln-tenable">Tenable OT</label>
            </div>
            <div class="brand-option">
              <input type="radio" id="vuln-claroty" name="vuln-brand" value="Claroty">
              <label for="vuln-claroty">Claroty</label>
            </div>
          </div>
        </div>

        <div class="solution-item">
          <div class="solution-checkbox">
            <input type="checkbox" id="sol-ips" onchange="toggleBrands('ips');renderArchitectureDiagram();">
            <label for="sol-ips">IPS (Intrusion Prevention System)</label>
          </div>
          <div class="brands-group" id="brands-ips">
            <div class="brand-option">
              <input type="radio" id="ips-txone" name="ips-brand" value="TXOne Networks">
              <label for="ips-txone">TXOne Networks</label>
            </div>
          </div>
        </div>

        <div class="solution-item">
          <div class="solution-checkbox">
            <input type="checkbox" id="sol-access" onchange="toggleBrands('access');renderArchitectureDiagram();">
            <label for="sol-access">Acceso Seguro / ZTNA</label>
          </div>
          <div class="brands-group" id="brands-access">
            <div class="brand-option">
              <input type="radio" id="access-cyolo" name="access-brand" value="Cyolo">
              <label for="access-cyolo">Cyolo</label>
            </div>
            <div class="brand-option">
              <input type="radio" id="access-claroty" name="access-brand" value="Claroty">
              <label for="access-claroty">Claroty</label>
            </div>
            <div class="brand-option">
              <input type="radio" id="access-fortinet" name="access-brand" value="Fortinet">
              <label for="access-fortinet">Fortinet</label>
            </div>
          </div>
        </div>

        <div class="solution-item">
          <div class="solution-checkbox">
            <input type="checkbox" id="sol-deception" onchange="toggleBrands('deception');renderArchitectureDiagram();">
            <label for="sol-deception">Deception (Se√±uelos OT)</label>
          </div>
          <div class="brands-group" id="brands-deception">
            <div class="brand-option">
              <input type="radio" id="dec-fortinet" name="deception-brand" value="Fortinet">
              <label for="dec-fortinet">Fortinet</label>
            </div>
            <div class="brand-option">
              <input type="radio" id="dec-zscaler" name="deception-brand" value="Zscaler">
              <label for="dec-zscaler">Zscaler</label>
            </div>
          </div>
        </div>

        <div class="solution-item">
          <div class="solution-checkbox">
            <input type="checkbox" id="sol-soc" onchange="toggleBrands('soc');renderArchitectureDiagram();">
            <label for="sol-soc">SOC (SIEM / Monitoreo)</label>
          </div>
          <div class="brands-group" id="brands-soc">
            <div class="brand-option">
              <input type="radio" id="soc-splunk" name="soc-brand" value="Splunk">
              <label for="soc-splunk">Splunk</label>
            </div>
          </div>
        </div>

      </div>

      <div class="buttons-group">
        <button type="button" class="btn btn-secondary" onclick="goBackStep1()">Regresar</button>
        <button type="button" class="btn btn-primary" onclick="openOutlook()">Abrir en Outlook</button>
      </div>

      <div id="fallback" style="display:none" class="fallback-section">
        <h3>El enlace mailto es muy largo. Copie el contenido:</h3>
        <p style="margin-bottom:10px;color:#a8dadc;"><strong>Para:</strong> <span id="fallback-to"></span></p>
        <p style="margin-bottom:10px;color:#a8dadc;"><strong>Asunto:</strong> <span id="fallback-subject"></span></p>
        <textarea id="fallback-body" readonly></textarea>
        <button type="button" class="btn btn-primary" style="margin-top:10px;" onclick="copyToClipboard()">Copiar al portapapeles</button>
      </div>
    </form>
  </div>

  <div class="diagram-panel">
    <h2>Diagrama IT/OT ‚Äì Maqueta Showroom</h2>
    <p style="font-size:.8em;color:#9ca3af;margin-bottom:8px;">
      Se muestran todas las capas Purdue (Nivel 4 a Nivel 0), junto con los componentes principales:
      ERP/MES, FW OT, IPS, visibilidad OT, estaci√≥n de ingenier√≠a, HMI, PLCs, motores/sensores y la consola de SOC.
    </p>
    <div id="diagram-container"></div>
  </div>
</div>

<script>
const mailtoRecipient = 'felipe.tabares@scitum.com.mx';

/* -------------------------
   INVITADOS
------------------------- */
let guests = [];
function addGuest(){
  const nameInput = document.getElementById('guestNameInput');
  const roleInput = document.getElementById('guestRoleInput');
  const name = nameInput.value.trim();
  const role = roleInput.value.trim();
  if(!name && !role) return;
  guests.push({name,role});
  nameInput.value = '';
  roleInput.value = '';
  renderGuestList();
}
function editGuest(idx){
  if(idx<0 || idx>=guests.length) return;
  const g = guests[idx];
  const newName = prompt('Nombre del invitado:', g.name || '');
  if(newName === null) return;
  const newRole = prompt('Puesto del invitado:', g.role || '');
  if(newRole === null) return;
  guests[idx] = {name:newName.trim(), role:newRole.trim()};
  renderGuestList();
}
function removeGuest(idx){
  if(idx<0 || idx>=guests.length) return;
  guests.splice(idx,1);
  renderGuestList();
}
function renderGuestList(){
  const container = document.getElementById('guestList');
  if(!container) return;
  if(guests.length === 0){
    container.innerHTML = '<span style="font-size:0.8em;color:#718096;">Sin invitados capturados a√∫n.</span>';
    return;
  }
  let html = '<ul style="padding-left:0;margin:0;list-style:none;">';
  guests.forEach((g,idx)=>{
    const safeName = g.name || 'Sin nombre';
    const safeRole = g.role || 'Sin puesto';
    html += `
      <li class="guest-list-item">
        <span class="guest-text">${idx+1}. ${safeName} ‚Äì ${safeRole}</span>
        <span class="guest-actions">
          <button type="button" class="guest-btn edit" onclick="editGuest(${idx})">Editar</button>
          <button type="button" class="guest-btn delete" onclick="removeGuest(${idx})">Eliminar</button>
        </span>
      </li>`;
  });
  html += '</ul>';
  container.innerHTML = html;
}

/* -------------------------
   WIZARD PASO 1 / PASO 2
------------------------- */
function validateStep1Basics(){
  const client = document.getElementById('clientName').value.trim();
  const dateVal = document.getElementById('requestedDate').value.trim();

  if(!client){
    alert('Por favor complete el nombre del cliente.');
    return false;
  }
  if(!dateVal){
    alert('Por favor seleccione una fecha y horario en el calendario.');
    return false;
  }
  return true;
}
function goToStep2(){
  if(!validateStep1Basics()) return;
  // registrar reserva en memoria (bloquea hora previa y siguiente)
  registerCurrentReservation();
  document.getElementById('step1-wrapper').style.display = 'none';
  document.getElementById('step2-wrapper').style.display = 'grid';
  renderArchitectureDiagram();
}
function goBackStep1(){
  document.getElementById('step2-wrapper').style.display = 'none';
  document.getElementById('step1-wrapper').style.display = 'grid';
  // Reset de selecci√≥n de d√≠a y hora al regresar
  selectedDay = null;
  selectedTime = null;
  const hidden = document.getElementById('requestedDate');
  if (hidden) hidden.value = '';
  buildCalendar();
}

/* -------------------------
   SELECCI√ìN DE MARCAS
------------------------- */
function toggleBrands(solutionId){
  const checkbox = document.getElementById('sol-'+solutionId);
  const brandsGroup = document.getElementById('brands-'+solutionId);
  const radios = brandsGroup ? brandsGroup.querySelectorAll('input[type="radio"]') : [];
  if(checkbox.checked){
    if(brandsGroup) brandsGroup.classList.add('active');
    if(radios.length > 0){
      const anyChecked = Array.from(radios).some(r => r.checked);
      if(!anyChecked){
        radios[0].checked = true;
      }
    }
  }else{
    if(brandsGroup) brandsGroup.classList.remove('active');
    radios.forEach(r=>r.checked=false);
  }
}
function getSelectedBrand(groupName){
  const radio = document.querySelector(`input[name="${groupName}"]:checked`);
  return radio ? radio.value : null;
}

/* -------------------------
   VALIDACI√ìN FORM + MAILTO
------------------------- */
function getSelectedSolutions(){
  const solutions = [];
  function pick(id,name,group){
    const chk = document.getElementById(id);
    if(chk && chk.checked){
      const brandText = group ? getSelectedBrand(group) : null;
      solutions.push({name,brand:brandText || 'Sin marca seleccionada'});
    }
  }
  pick('sol-fw-ot','FW OT','fw-ot-brand');
  pick('sol-visibility','Visibilidad de Red OT','visibility-brand');
  pick('sol-vuln','Gesti√≥n de vulnerabilidades OT','vuln-brand');
  pick('sol-ips','IPS','ips-brand');
  pick('sol-access','Acceso Seguro / ZTNA','access-brand');
  pick('sol-deception','Deception OT','deception-brand');
  pick('sol-soc','SOC','soc-brand');
  return solutions;
}

function validateFormStep2(){
  const client = document.getElementById('clientName').value.trim();
  const dateVal = document.getElementById('requestedDate').value.trim();

  const solIds = [
    {chk:'sol-fw-ot', brandGroup:'fw-ot-brand', label:'FW OT'},
    {chk:'sol-visibility', brandGroup:'visibility-brand', label:'Visibilidad de Red OT'},
    {chk:'sol-vuln', brandGroup:'vuln-brand', label:'Gesti√≥n de vulnerabilidades OT'},
    {chk:'sol-ips', brandGroup:'ips-brand', label:'IPS'},
    {chk:'sol-access', brandGroup:'access-brand', label:'Acceso Seguro / ZTNA'},
    {chk:'sol-deception', brandGroup:'deception-brand', label:'Deception OT'},
    {chk:'sol-soc', brandGroup:'soc-brand', label:'SOC'}
  ];
  const anySolutionChecked = solIds.some(s => {
    const chk = document.getElementById(s.chk);
    return chk && chk.checked;
  });

  if(!client || !dateVal || !anySolutionChecked){
    return false;
  }

  const missingBrands = [];
  solIds.forEach(s=>{
    const chk = document.getElementById(s.chk);
    if(chk && chk.checked){
      const brand = getSelectedBrand(s.brandGroup);
      if(!brand){
        missingBrands.push(s.label);
      }
    }
  });

  if(missingBrands.length > 0){
    alert('Debe seleccionar una marca para: ' + missingBrands.join(', '));
    return false;
  }

  return true;
}

function buildMailto(){
  if(!validateFormStep2()){
    alert('Por favor complete todos los campos obligatorios y seleccione al menos una soluci√≥n con marca.');
    return null;
  }

  const client = document.getElementById('clientName').value.trim();
  const dateIso = document.getElementById('requestedDate').value.trim();
  const comments = document.getElementById('comments').value.trim();
  const companyName = document.getElementById('companyName').value.trim();
  const guestCount = document.getElementById('guestCount').value.trim();
  const sector = document.getElementById('sector').value.trim();
  const requiresLabTeam = document.getElementById('labTeamPresent').checked;
  const solutions = getSelectedSolutions();

  const dateObj = new Date(dateIso);
  const dateStr = dateObj.toLocaleString('es-ES',{
    year:'numeric',month:'2-digit',day:'2-digit',
    hour:'2-digit',minute:'2-digit'
  });

  const gList = guests || [];

  const subject = `Showroom IT/OT ‚Äì Reserva para ${client} (${dateStr})`;

  let body  = `Estimado equipo de Showroom IT/OT,\n\n`;
  body += `Solicito la reserva del showroom con los siguientes detalles:\n\n`;

  body += `DATOS DEL CLIENTE\n`;
  body += `-----------------\n`;
  body += `Cliente (persona): ${client}\n`;
  if(companyName) body += `Empresa: ${companyName}\n`;
  if(sector) body += `Sector: ${sector}\n`;
  if(guestCount) body += `N√∫mero de invitados: ${guestCount}\n`;
  body += `Fecha y hora solicitadas: ${dateStr}\n\n`;

  if(gList.length>0){
    body += `INVITADOS DEL CLIENTE\n`;
    body += `--------------------\n`;
    gList.forEach((g,i)=>{
      const nameInv = g.name || 'Sin nombre';
      const roleInv = g.role || 'Sin puesto';
      body += `${i+1}. ${nameInv} ‚Äì ${roleInv}\n`;
    });
    body += `\n`;
  }

  body += `SOLUCIONES A DEMOSTRAR\n`;
  body += `----------------------\n`;
  solutions.forEach((s,i)=>{
    body += `${i+1}. ${s.name} - Marca: ${s.brand}\n`;
  });

  if(comments){
    body += `\nCOMENTARIOS ADICIONALES\n`;
    body += `-----------------------\n`;
    body += comments + '\n';
  }

  if(requiresLabTeam){
    body += `\nREQUERIMIENTOS ADICIONALES\n`;
    body += `------------------------\n`;
    body += `‚Ä¢ El cliente solicita que la presentaci√≥n sea impartida por el equipo de laboratorio.\n`;
  }

  return {to:mailtoRecipient,subject,body};
}

function openOutlook(){
  if(!validateStep1Basics()) return;

  const mailData = buildMailto();
  if(!mailData) return;

  // Exportamos reservas a CSV cada vez que se genera el correo
  exportReservationsToCSV();

  const mailtoLink = `mailto:${encodeURIComponent(mailData.to)}?subject=${encodeURIComponent(mailData.subject)}&body=${encodeURIComponent(mailData.body)}`;
  if(mailtoLink.length>1900){
    document.getElementById('fallback-to').textContent = mailData.to;
    document.getElementById('fallback-subject').textContent = mailData.subject;
    document.getElementById('fallback-body').value = mailData.body;
    document.getElementById('fallback').style.display='block';
  }else{
    document.getElementById('fallback').style.display='none';
    window.location.href = mailtoLink;
  }
}

function copyToClipboard(){
  const textarea = document.getElementById('fallback-body');
  const to = document.getElementById('fallback-to').textContent;
  const subject = document.getElementById('fallback-subject').textContent;
  const fullText = `Para: ${to}\n\nAsunto: ${subject}\n\n${textarea.value}`;
  navigator.clipboard.writeText(fullText).then(()=>{
    alert('Contenido copiado al portapapeles');
  }).catch(()=>{
    textarea.select();
    document.execCommand('copy');
    alert('Contenido copiado al portapapeles');
  });
}

/* -------------------------
   CALENDARIO + RESERVAS
------------------------- */
let reservations = [];  // {date:'YYYY-MM-DD', start:'HH:MM', end:'HH:MM', status:'ocupado'|'bloqueado'}
let calendarBaseDate = new Date();
let selectedDay = null;
let selectedTime = null;

// Sesiones de 1 hora entre 10:00 y 17:00 (√∫ltimo slot empieza 16:00)
const timeSlots = ['10:00','11:00','12:00','13:00','14:00','15:00','16:00'];

function formatDateKey(year, monthIndex, day) {
  const m = String(monthIndex + 1).padStart(2, '0');
  const d = String(day).padStart(2, '0');
  return `${year}-${m}-${d}`;
}

function isSlotTaken(dateKey, timeStr) {
  return reservations.some(r => r.date === dateKey && r.start === timeStr);
}

/* Un d√≠a se pinta rojo s√≥lo si TODOS los horarios est√°n ocupados/bloqueados */
function isDayFullyBooked(dateKey) {
  if (!dateKey) return false;
  return timeSlots.every(t => isSlotTaken(dateKey, t));
}

function getMonthLabel(date) {
  const meses = ['Enero','Febrero','Marzo','Abril','Mayo','Junio',
                 'Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
  return `${meses[date.getMonth()]} ${date.getFullYear()}`;
}

function buildCalendar() {
  const grid = document.getElementById('calendar-grid');
  const label = document.getElementById('calendar-month-label');
  if (!grid || !label) return;

  grid.innerHTML = '';

  const base = new Date(calendarBaseDate.getFullYear(), calendarBaseDate.getMonth(), 1);
  label.textContent = getMonthLabel(base);

  const dias = ['L','M','X','J','V','S','D'];
  dias.forEach(d => {
    const h = document.createElement('div');
    h.className = 'calendar-day-header';
    h.textContent = d;
    grid.appendChild(h);
  });

  const firstDayIndex = (base.getDay() + 6) % 7; // Lunes = 0
  const daysInMonth = new Date(base.getFullYear(), base.getMonth() + 1, 0).getDate();

  for (let i = 0; i < firstDayIndex; i++) {
    const empty = document.createElement('div');
    empty.className = 'calendar-day empty';
    grid.appendChild(empty);
  }

  const today = new Date();
  const todayKey = formatDateKey(today.getFullYear(), today.getMonth(), today.getDate());
  const todayDate = new Date(todayKey); // normalizado sin hora

  for (let day = 1; day <= daysInMonth; day++) {
    const cell = document.createElement('div');
    cell.textContent = day;
    cell.className = 'calendar-day';

    const dateKey = formatDateKey(base.getFullYear(), base.getMonth(), day);
    const cellDate = new Date(dateKey);

    if (dateKey === todayKey) {
      cell.classList.add('today');
    }

    // No permitir seleccionar d√≠as pasados
    if (cellDate < todayDate) {
      cell.classList.add('disabled');
      cell.onclick = null;
    } else if (isDayFullyBooked(dateKey)) {
      cell.classList.add('fully-booked');
      cell.onclick = null;
    } else {
      cell.onclick = () => handleDayClick(dateKey, cell);
    }

    if (selectedDay === dateKey) {
      cell.classList.add('selected');
    }

    grid.appendChild(cell);
  }

  if (selectedDay) {
    renderTimeSlots(selectedDay);
  } else {
    renderTimeSlots(null);
  }
}

function changeMonth(delta) {
  const year = calendarBaseDate.getFullYear();
  const month = calendarBaseDate.getMonth();
  calendarBaseDate = new Date(year, month + delta, 1);
  buildCalendar();
}

function handleDayClick(dateKey, cell) {
  if (isDayFullyBooked(dateKey)) {
    alert('Este d√≠a ya no tiene horarios disponibles.');
    return;
  }

  selectedDay = dateKey;
  selectedTime = null;

  document.querySelectorAll('.calendar-day').forEach(d => d.classList.remove('selected'));
  cell.classList.add('selected');

  renderTimeSlots(dateKey);
  updateRequestedDateHidden();
}

function renderTimeSlots(dateKey) {
  const list = document.getElementById('time-slot-list');
  if (!list) return;
  list.innerHTML = '';

  if (!dateKey) {
    const msg = document.createElement('div');
    msg.style.color = '#9ca3af';
    msg.style.fontSize = '0.8rem';
    msg.textContent = 'Selecciona primero un d√≠a en el calendario.';
    list.appendChild(msg);
    return;
  }

  timeSlots.forEach(timeStr => {
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'time-slot-btn';
    btn.textContent = timeStr;

    if (isSlotTaken(dateKey, timeStr)) {
      btn.classList.add('busy');
      btn.disabled = true;
    } else {
      btn.onclick = () => handleTimeClick(dateKey, timeStr, btn);
    }

    if (selectedDay === dateKey && selectedTime === timeStr) {
      btn.classList.add('selected');
    }

    list.appendChild(btn);
  });
}

function handleTimeClick(dateKey, timeStr, btn) {
  if (isSlotTaken(dateKey, timeStr)) {
    alert('Este horario ya est√° ocupado o bloqueado. Selecciona otro.');
    return;
  }

  selectedDay = dateKey;
  selectedTime = timeStr;

  document.querySelectorAll('.time-slot-btn').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');

  updateRequestedDateHidden();
}

function updateRequestedDateHidden() {
  const hidden = document.getElementById('requestedDate');
  if (!hidden) return;

  if (!selectedDay || !selectedTime) {
    hidden.value = '';
    return;
  }

  hidden.value = `${selectedDay}T${selectedTime}:00`;
}

function addOneHour(timeStr) {
  const [h, m] = timeStr.split(':').map(Number);
  const newH = h + 1;
  return `${String(newH).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
}

/* Registra la reserva actual + bloqueos (misma fecha) */
function registerCurrentReservation() {
  const hidden = document.getElementById('requestedDate');
  if (!hidden || !hidden.value) return;

  const [datePart, timePartFull] = hidden.value.split('T');
  const timePart = timePartFull.slice(0,5);

  if (!timeSlots.includes(timePart)) return;

  if (!reservations.some(r => r.date === datePart && r.start === timePart)) {
    reservations.push({
      date: datePart,
      start: timePart,
      end: addOneHour(timePart),
      status: 'ocupado'
    });
  }

  const idx = timeSlots.indexOf(timePart);
  const vecinos = [];
  if (idx > 0) vecinos.push(timeSlots[idx - 1]);
  if (idx < timeSlots.length - 1) vecinos.push(timeSlots[idx + 1]);

  vecinos.forEach(t => {
    if (!reservations.some(r => r.date === datePart && r.start === t)) {
      reservations.push({
        date: datePart,
        start: t,
        end: addOneHour(t),
        status: 'bloqueado'
      });
    }
  });

  buildCalendar();
}

/* Exporta reservas a CSV (compatible con Excel) */
function exportReservationsToCSV() {
  if (!reservations || reservations.length === 0) {
    return; // nada que exportar
  }
  const headers = ['Fecha','HoraInicio','HoraFin','Estado'];
  const rows = [headers.join(',')];

  reservations.forEach(r => {
    const row = [
      r.date,
      r.start,
      r.end,
      r.status || 'ocupado'
    ].map(v => `"${(v||'').replace(/"/g,'""')}"`);
    rows.push(row.join(','));
  });

  const csvContent = rows.join('\r\n');
  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'reservas.csv';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

/* -------------------------
   DIAGRAMA IT/OT (sencillo)
------------------------- */

// Helper: obtener marca actual o texto gen√©rico
function getBrandLabel(groupName, defaultLabel){
  const b = getSelectedBrand(groupName);
  return b ? b : defaultLabel;
}

// Helper: ¬øest√° seleccionada la soluci√≥n?
function isSolutionSelected(id){
  const chk = document.getElementById(id);
  return !!(chk && chk.checked);
}

function renderArchitectureDiagram(){
  const container = document.getElementById('diagram-container');
  if(!container) return;
  container.innerHTML = '';

  const svgNS = 'http://www.w3.org/2000/svg';
  const svg = document.createElementNS(svgNS,'svg');
  svg.setAttribute('viewBox','0 0 900 450');
  svg.setAttribute('width','100%');
  svg.setAttribute('height','100%');

  // Fondo
  const bg = document.createElementNS(svgNS,'rect');
  bg.setAttribute('x','0');
  bg.setAttribute('y','0');
  bg.setAttribute('width','900');
  bg.setAttribute('height','450');
  bg.setAttribute('fill','#020617');
  svg.appendChild(bg);

  // Capas Purdue
  const layers = [
    {y:40,  label:'Nivel 4 ‚Äì Empresa / IT'},
    {y:100, label:'Nivel 3 ‚Äì DMZ / Per√≠metro OT'},
    {y:160, label:'Nivel 2 ‚Äì SCADA / HMI'},
    {y:220, label:'Nivel 1 ‚Äì Control (PLCs)'},
    {y:280, label:'Nivel 0 ‚Äì Campo (Motores / Sensores)'}
  ];

  layers.forEach(l=>{
    const rect = document.createElementNS(svgNS,'rect');
    rect.setAttribute('x','20');
    rect.setAttribute('y',String(l.y));
    rect.setAttribute('width','560');
    rect.setAttribute('height','50');
    rect.setAttribute('fill','#0b1220');
    rect.setAttribute('stroke','#1f2937');
    rect.setAttribute('stroke-width','1.5');
    svg.appendChild(rect);

    const text = document.createElementNS(svgNS,'text');
    text.setAttribute('x','30');
    text.setAttribute('y',String(l.y+30));
    text.setAttribute('fill','#9ca3af');
    text.setAttribute('font-size','12');
    text.setAttribute('font-family','Segoe UI, sans-serif');
    text.textContent = l.label;
    svg.appendChild(text);
  });

  // Componentes principales por nivel
  function addBox(x,y,w,h,label,subLabel,fillColor,strokeColor){
    const r = document.createElementNS(svgNS,'rect');
    r.setAttribute('x',String(x));
    r.setAttribute('y',String(y));
    r.setAttribute('width',String(w));
    r.setAttribute('height',String(h));
    r.setAttribute('rx','6');
    r.setAttribute('ry','6');
    r.setAttribute('fill',fillColor);
    r.setAttribute('stroke',strokeColor);
    r.setAttribute('stroke-width','1.5');
    svg.appendChild(r);

    const t = document.createElementNS(svgNS,'text');
    t.setAttribute('x',String(x+8));
    t.setAttribute('y',String(y+18));
    t.setAttribute('fill','#e5e7eb');
    t.setAttribute('font-size','12');
    t.setAttribute('font-family','Segoe UI, sans-serif');
    t.textContent = label;
    svg.appendChild(t);

    if(subLabel){
      const ts = document.createElementNS(svgNS,'text');
      ts.setAttribute('x',String(x+8));
      ts.setAttribute('y',String(y+33));
      ts.setAttribute('fill','#f97316');
      ts.setAttribute('font-size','11');
      ts.setAttribute('font-family','Segoe UI, sans-serif');
      ts.textContent = subLabel;
      svg.appendChild(ts);
    }
  }

  // Nivel 4 ‚Äì ERP / MES
  addBox(340,50,220,30,'ERP / MES','Aplicaciones de negocio','#111827','#1f2937');

  // Nivel 3 ‚Äì DMZ / FW OT / IPS / Visibilidad
  const fwSelected   = isSolutionSelected('sol-fw-ot');
  const fwBrand      = getBrandLabel('fw-ot-brand','FW OT');
  const fwFill       = fwSelected ? '#7c2d12' : '#020617';
  const fwStroke     = fwSelected ? '#f97316' : '#374151';
  addBox(40,110,140,40,'FW OT',fwBrand,fwFill,fwStroke);

  const ipsSelected  = isSolutionSelected('sol-ips');
  const ipsBrand     = getBrandLabel('ips-brand','IPS');
  const ipsFill      = ipsSelected ? '#7c2d12' : '#020617';
  const ipsStroke    = ipsSelected ? '#f97316' : '#374151';
  addBox(190,110,120,40,'IPS',ipsBrand,ipsFill,ipsStroke);

  const visSelected  = isSolutionSelected('sol-visibility');
  const visBrand     = getBrandLabel('visibility-brand','Visibilidad OT');
  const visFill      = visSelected ? '#0f172a' : '#020617';
  const visStroke    = visSelected ? '#38bdf8' : '#374151';
  addBox(320,110,200,40,'Visibilidad OT',visBrand,visFill,visStroke);

  // Nivel 2 ‚Äì Estaci√≥n de Ingenier√≠a / HMI
  addBox(60,170,150,40,'Estaci√≥n de Ingenier√≠a','SCADA / Eng.','#0b1120','#374151');
  addBox(230,170,150,40,'HMI',null,'#0b1120','#374151');

  // Nivel 1 ‚Äì PLCs
  addBox(110,230,130,40,'PLCs','Control','#020617','#4b5563');

  // Nivel 0 ‚Äì Motores / Sensores
  addBox(80,290,130,40,'Motores',null,'#020617','#4b5563');
  addBox(230,290,130,40,'Sensores',null,'#020617','#4b5563');

  // Acceso Seguro / ZTNA
  const accessSelected = isSolutionSelected('sol-access');
  const accessBrand    = getBrandLabel('access-brand','ZTNA / VPN');
  const accFill        = accessSelected ? '#022c22' : '#020617';
  const accStroke      = accessSelected ? '#22c55e' : '#374151';
  addBox(540,110,180,40,'Acceso Seguro',accessBrand,accFill,accStroke);

  // Deception
  const decSelected = isSolutionSelected('sol-deception');
  const decBrand    = getBrandLabel('deception-brand','Deception');
  const decFill     = decSelected ? '#312e81' : '#020617';
  const decStroke   = decSelected ? '#6366f1' : '#374151';
  addBox(540,170,180,40,'Deception OT',decBrand,decFill,decStroke);

  // SOC / SIEM / Splunk
  const socSelected = isSolutionSelected('sol-soc');
  const socBrand    = getBrandLabel('soc-brand','SOC / SIEM');
  const socFill     = socSelected ? '#1f2937' : '#020617';
  const socStroke   = socSelected ? '#f97316' : '#374151';

  const socX = 620;
  const socY = 40;
  const socW = 240;
  const socH = 90;

  const socRect = document.createElementNS(svgNS,'rect');
  socRect.setAttribute('x',String(socX));
  socRect.setAttribute('y',String(socY));
  socRect.setAttribute('width',String(socW));
  socRect.setAttribute('height',String(socH));
  socRect.setAttribute('rx','10');
  socRect.setAttribute('ry','10');
  socRect.setAttribute('fill',socFill);
  socRect.setAttribute('stroke',socStroke);
  socRect.setAttribute('stroke-width','1.8');
  svg.appendChild(socRect);

  const socTitle = document.createElementNS(svgNS,'text');
  socTitle.setAttribute('x',String(socX+10));
  socTitle.setAttribute('y',String(socY+22));
  socTitle.setAttribute('fill','#e5e7eb');
  socTitle.setAttribute('font-size','13');
  socTitle.setAttribute('font-family','Segoe UI, sans-serif');
  socTitle.textContent = 'SOC / Consola SIEM';
  svg.appendChild(socTitle);

  const socBrandText = document.createElementNS(svgNS,'text');
  socBrandText.setAttribute('x',String(socX+10));
  socBrandText.setAttribute('y',String(socY+40));
  socBrandText.setAttribute('fill','#f97316');
  socBrandText.setAttribute('font-size','12');
  socBrandText.setAttribute('font-family','Segoe UI, sans-serif');
  socBrandText.textContent = socBrand;
  svg.appendChild(socBrandText);

  const socSub = document.createElementNS(svgNS,'text');
  socSub.setAttribute('x',String(socX+10));
  socSub.setAttribute('y',String(socY+60));
  socSub.setAttribute('fill','#9ca3af');
  socSub.setAttribute('font-size','11');
  socSub.setAttribute('font-family','Segoe UI, sans-serif');
  socSub.textContent = 'Correlaci√≥n de eventos, dashboards y alertas.';
  svg.appendChild(socSub);

  // "Splunk" como ejemplo de SIEM
  const splunkBox = document.createElementNS(svgNS,'rect');
  splunkBox.setAttribute('x',String(socX+135));
  splunkBox.setAttribute('y',String(socY+58));
  splunkBox.setAttribute('width','80');
  splunkBox.setAttribute('height','25');
  splunkBox.setAttribute('rx','6');
  splunkBox.setAttribute('ry','6');
  splunkBox.setAttribute('fill','#030712');
  splunkBox.setAttribute('stroke','#4b5563');
  splunkBox.setAttribute('stroke-width','1');
  svg.appendChild(splunkBox);

  const splunkText = document.createElementNS(svgNS,'text');
  splunkText.setAttribute('x',String(socX+145));
  splunkText.setAttribute('y',String(socY+75));
  splunkText.setAttribute('fill','#e5e7eb');
  splunkText.setAttribute('font-size','12');
  splunkText.setAttribute('font-family','Segoe UI, sans-serif');
  splunkText.textContent = 'Splunk';
  svg.appendChild(splunkText);

  // Flechas simples (sin animaci√≥n)
  const defs = document.createElementNS(svgNS,'defs');
  const marker = document.createElementNS(svgNS,'marker');
  marker.setAttribute('id','arrowhead');
  marker.setAttribute('markerWidth','8');
  marker.setAttribute('markerHeight','8');
  marker.setAttribute('refX','5');
  marker.setAttribute('refY','3');
  marker.setAttribute('orient','auto');
  const markerPath = document.createElementNS(svgNS,'path');
  markerPath.setAttribute('d','M0,0 L6,3 L0,6 z');
  markerPath.setAttribute('fill','#f97316');
  marker.appendChild(markerPath);
  defs.appendChild(marker);
  svg.appendChild(defs);

  function addArrow(x1,y1,x2,y2,color){
    const line = document.createElementNS(svgNS,'line');
    line.setAttribute('x1',String(x1));
    line.setAttribute('y1',String(y1));
    line.setAttribute('x2',String(x2));
    line.setAttribute('y2',String(y2));
    line.setAttribute('stroke',color);
    line.setAttribute('stroke-width','2');
    line.setAttribute('marker-end','url(#arrowhead)');
    svg.appendChild(line);
  }

  // Flujos principales
  // Datos (amarillo)
  addArrow(260,190, 640,120, '#facc15'); // HMI -> SOC
  addArrow(240,250, 640,120, '#facc15'); // PLCs -> SOC (datos)

  // Logs de seguridad (rojo) desde FW/IPS/Visibilidad
  addArrow(110,130, 640,120, '#ef4444'); // FW OT -> SOC
  addArrow(250,130, 640,120, '#ef4444'); // IPS -> SOC
  addArrow(420,130, 640,120, '#ef4444'); // Visibilidad OT -> SOC

  container.appendChild(svg);
}

/* -------------------------
   INIT
------------------------- */
document.addEventListener('DOMContentLoaded', () => {
  renderGuestList();
  buildCalendar();

  // Cada cambio de radio/checkbox en soluciones actualiza diagrama
  document.querySelectorAll('#step2-wrapper input[type="radio"],#step2-wrapper input[type="checkbox"]').forEach(el=>{
    el.addEventListener('change', ()=>{
      renderArchitectureDiagram();
    });
  });
});
</script>
</body>
</html>
